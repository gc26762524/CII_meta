library(reshape2)
library(ggplot2)
library(RColorBrewer)


setwd("~/Desktop")

input <-"orthology	SS1a	SS2b	SS4d	SS6f
Aging	243.667671938496	217.221546821733	226.704969507923	223.371479976956
Amino acid metabolism	2581.80549064176	2611.02241628983	2603.57256223059	2604.58072052637
Biosynthesis of other secondary metabolites	1232.30729372624	1217.64171029424	1231.99102526157	1211.43202740611
Cancers: Overview	161.329839248663	160.520464937469	157.123506050483	158.246261614117
Cancers: Specific types	44.2019216797375	47.3192372004455	46.689550297947	45.5307541776336
Carbohydrate metabolism	2717.36511835195	2662.54770385957	2668.01935828645	2691.38475984575
Cardiovascular diseases	49.9276976002677	52.6651037119124	53.0214107699764	50.0528525768473
Cell growth and death	444.532349107124	437.174671801181	440.197196530469	434.973916647941
Cell motility	236.015198706991	305.892529598458	304.586994203365	301.602991280123
Cellular community - eukaryotes	0.773538026139749	0.866517167757145	0.882363051897383	0.194684664957483
Cellular community - prokaryotes	283.318367443994	305.323240052998	301.275668977647	302.53795441507
Chemical structure transformation maps	109.792941699997	155.346623035237	154.060732573727	170.613162573135
Circulatory system	10.8390085569903	12.3647145957774	13.6340885330546	12.2430777703981
Development	0.268118364256898	0.233597247218684	0.266042950700821	0.188647103890825
Digestive system	16.9320953936965	18.8407238240524	16.9348484346438	18.2325442487041
Drug resistance: Antimicrobial	179.495153243569	191.792551209626	192.917058779291	190.714902754438
Drug resistance: Antineoplastic	174.663788792646	181.668529436479	179.514106690262	180.451387276825
Endocrine and metabolic diseases	189.454311549777	173.056803644319	178.896007405399	177.039593799333
Endocrine system	252.042872309672	257.84708759342	252.439363039955	259.936623836469
Energy metabolism	1289.00248856582	1281.77145075474	1283.15601808275	1279.90707634099
Environmental adaptation	26.9778899843495	30.8336584450527	30.5121009579376	31.172757118384
Excretory system	106.792454692234	102.03066397314	103.597579721362	105.549123597239
Folding, sorting and degradation;	535.804880397317	531.896559397153	539.832502532077	524.15370971267
Global and overview maps	1539.36410033266	1542.12997842853	1550.47515000733	1542.86885232004
Glycan biosynthesis and metabolism	361.46408659051	391.868625982103	382.179246605158	381.418753429356
Immune diseases	8.19718369013533	10.2721924406613	9.89633231474649	9.21822696866956
Immune system	22.6925501660211	28.1713984834715	28.5010406016103	25.9742780098148
Infectious diseases: Bacterial	161.41378812523	150.716196786525	154.378847852612	149.251387613701
Infectious diseases: Parasitic	14.9929930103492	15.5897871401529	15.3591218662219	14.9669887033063
Infectious diseases: Viral	14.4407468656618	16.8208997238398	18.4403347868103	14.9752015839587
Lipid metabolism	1470.23041476017	1552.53411568437	1480.55956869336	1558.45222680237
Membrane transport	202.494759894904	218.393982664214	214.819552700589	214.797183612705
Metabolism of cofactors and vitamins	1755.19593762444	1743.8905900031	1771.80186308283	1736.91269908852
Metabolism of other amino acids	1278.05706082475	1293.5174231325	1293.75255055373	1308.80214718048
Metabolism of terpenoids and polyketides	734.654236053166	763.704162451299	745.652816936683	760.5676517863
Nervous system	64.2451289394922	64.3325729581396	63.4842297990012	64.6047457424808
Neurodegenerative diseases	60.8411024750092	62.1760636412887	66.589109043193	60.3595553587271
Nucleotide metabolism	270.864998447694	271.055714869883	273.98067368993	264.796260881335
Replication and repair	682.068463344288	676.435731026175	683.611582322034	668.96174354335
Sensory system	1.4500201305721	0.597891633714212	0.967333262856225	0.247089901759814
Signal transduction	242.428099878789	243.789131973357	246.955634591313	241.485010007864
Signaling molecules and interaction	0.507617008011476	0.372349762762564	0.462577197627788	0.421746199781226
Substance dependence	13.3848819080466	12.4370723543078	12.4103181663375	13.0998369680146
Transcription	97.8548075899705	89.3251169746756	90.4338115753503	87.5301074334642
Translation	676.25561217088	651.270241857584	668.945984839618	643.943863545644
Transport and catabolism	78.8275064324092	80.8667371312541	80.8658345472729	81.8732699924459
Xenobiotics biodegradation and metabolism	1437.71077358589	1485.37435146274	1447.81149874192	1503.13333746895"

data<-read.table(text=input, header=T, row.name = 1, sep="\t")
class(data)
data2<-t(data[,order(colnames(data))])
head(data2)
class(data2)
data3<-prop.table(data2, margin=1)

rowSums(data3)
head(data3)

data4<-data3*100

data5<-melt(data4, id.var="SampleID")
colnames(data5)<-c('SampleID', 'Function', 'Proportion')
pallet<-c(brewer.pal(12,"Paired"),brewer.pal(8,"Set2")[-c(7,8)],brewer.pal(8,"Dark2"),brewer.pal(12,"Set3"),brewer.pal(8,"Accent"),brewer.pal(11,"Spectral"))

p<-ggplot(data5, aes(x = SampleID, y = Proportion, fill = Function)) + 
	geom_bar(stat = "identity",width = 0.7)+
  	guides(fill=guide_legend(title = NULL))+
  	scale_fill_manual(values = pallet)+
 	xlab("")+ylab("Sequence Number Percent(%)")+theme_bw()+
  	theme(text = element_text(size = 10),
        panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
        axis.line = element_line(),panel.border =  element_blank(),
        axis.text.x = element_text(angle = 45,size = 10,hjust = 1))+
  	scale_y_continuous(limits=c(0,101), expand = c(0, 0)
)


#ggsave(plot = p,filename = "all.merged.abundance.KeepID.Pathway.Level2.png",width = 20,height = 8,dpi = 300)
ggsave(plot = p,filename = "All.Function.abundance.KeepID.Pathway.Level2.pdf",width = 20,height = 8,dpi = 300)