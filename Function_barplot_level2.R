library(reshape2)
library(ggplot2)
library(RColorBrewer)


setwd("~/Desktop")

input <-"orthology	C10	M11	D10	C12	M13	D11	C13	M6	D2	C14	M7	D6	C15	M8	D8	C9	M9	D9
Aging	160.165493440606	162.792081511962	133.576608748447	173.514295965608	133.16636159584	132.090435565657	139.428955918453	124.293477645534	148.574594441401	121.123347327718	121.719876300986	154.920574070412	111.551993520622	130.06680612379	155.258519883215	120.225205586805	117.459111785545	147.709226660625
Amino acid metabolism	2271.17284081397	2251.81450336212	2180.33263070036	2184.57398793199	2371.94458129261	2355.03813584823	2345.24071118958	2183.44343467027	2428.58137116161	2451.1095696597	2448.40767763371	2307.07175748834	2543.88410082749	2399.8737911735	2473.89430648139	2542.86210618414	2043.56441034872	2364.33668180663
Biosynthesis of other secondary metabolites	1416.45492425735	1461.63701258482	1338.22062626432	1317.14738600029	1572.03584477105	1560.90421867252	1331.98593874287	1407.94716946575	1212.80521490122	1877.15178005111	1511.95993839774	1193.06737090262	2011.08631446443	1557.61897994108	1231.59290544511	1754.76586559258	1130.87008439452	1506.02806601768
Cancers: Overview	72.5304779128724	69.2947023756617	82.1428443948437	72.8689784806517	77.2001784912056	71.2243071090587	64.8434367696292	78.6432289498807	64.2902809516137	61.6072736142779	72.0828361592927	67.8671826077463	65.4082003920954	74.937193859323	64.8322190514957	64.0777309373555	77.9313257402728	70.2422560082013
Cancers: Specific types	15.0469407826586	14.3280711598595	17.9131205408897	17.7573328867941	15.1311850393347	14.2333355184602	16.5672863030034	17.5274157720126	15.9800718776137	13.4714998008663	15.0190629088853	16.3624545561999	14.7490373925227	14.388403075277	14.6805720697778	14.3301494797977	19.7598750802095	16.0741489807283
Carbohydrate metabolism	2529.8490936494	2523.8814110252	2428.82212014436	2497.63765117804	2482.69709304331	2437.25796820065	2508.78828650238	2401.25598941664	2491.45131674595	2458.62631597407	2530.24112320555	2475.27284553886	2464.28412797871	2516.7939818237	2450.53350627726	2494.79540046713	2297.20715580222	2484.71816898596
Cardiovascular diseases	32.1947829183095	30.425533657436	32.558477747129	32.780822237427	30.6531448536716	34.1316139583265	35.1758639480983	29.9156408311397	34.9341816379579	37.3381008642872	30.5904903061821	38.2840376663598	42.5805282309383	30.130923585098	33.0703172962691	35.1949880876686	28.3852117845097	33.2450400332307
Cell growth and death	356.254244806638	369.222364180948	355.276777261945	352.532629309861	365.173805868773	383.261392069267	352.509628573911	333.885913505369	361.758111291769	383.738134376668	363.343594231162	341.539395838611	390.91701316238	371.253828097962	363.99224059378	382.725715857564	308.33480557379	370.566687783366
Cell motility	284.634289986707	309.510842065896	176.163325784745	235.071774705295	180.95695697291	109.755741483873	299.198569234454	203.277083160795	580.725881227115	211.163815428106	255.165351365337	389.040579855533	149.401358092981	238.093141753405	526.300798378667	301.56044908551	307.651600277811	242.784075758514
Cellular community - eukaryotes	0.439892098931581	0.0795252059754914	0.387366195515171	0.115950349749894	0.197805385105763	0.0487465371488773	0.0340369472838262	0.147562411024887	0.0764960274230205	0.0110000231947819	0.00519071088963963	4.49935465528101	2.52129512910028	0.0447024528872508	0.0128885953022523	0.0114991484132905	0.0538283755489051	0.0201813936457856
Cellular community - prokaryotes	178.824193735836	188.696267267292	220.377607159827	181.507015919121	192.694006744452	183.798491321143	205.584624454739	253.914561904528	236.09686796442	194.541265184661	199.731044867585	195.870262240169	183.77535896591	186.653899744048	219.851612708917	204.846572224062	294.464667773244	182.627047076395
Chemical structure transformation maps	0	0	0	1.182941702	0	0	0	0	0	0	0.309732085	0	0.462212666	0.369994426	0.771066636	0	0	0
Circulatory system	1.03606925179314	0.898603413571756	0.433754223586333	0.401443861343478	0.851806224910448	0.111490663700944	0.343951427967947	0.119990629147102	1.98087426710717	0.403294668072463	0.0959394356731884	1.4034886995378	0.746790599438742	0.0996732794804348	1.19336278961258	0.363015663315217	0.149000211521301	0.321296839942063
Development	0.515794211506017	0.390497174043081	0.324787948269581	0.214225093853122	0.364404075886571	0.386986373112132	0.177935693138103	0.250178377272231	0.140428490568058	0.396212937171717	0.280596932929293	0.151503920283822	0.550436731292571	0.332612424740023	0.163873891367693	0.379509382116493	0.112206363671966	0.505037683322736
Digestive system	15.912522859767	12.717565612561	18.2579838805567	12.7794886902606	16.4465408137646	19.6751820986894	13.4095760126189	19.9322528750811	6.50436040349929	15.963012474485	14.8575478954288	10.9751570536969	18.3098655682832	14.9783045890181	7.31877322093519	13.7358831398103	18.8320088894107	14.2521935999691
Drug resistance: Antimicrobial	242.024138538499	252.104635513773	280.293866807735	213.272121035277	299.254093281878	296.563577274798	241.082158176713	314.861392635758	231.452316168241	302.925928075552	303.430067301698	239.560270016868	339.330919742401	297.652484623564	231.865696478006	309.512942598918	307.559681167455	256.217262827123
Drug resistance: Antineoplastic	207.014510449684	228.145995705876	207.236977903426	204.832506463912	229.085729958007	218.896111927626	198.213914256446	207.759025950083	188.041202593181	208.342873708615	230.069465711357	202.159622265226	218.562676677283	230.03411670235	198.001347962771	218.740900060199	183.220352908534	227.99282824639
Endocrine and metabolic diseases	122.671363412019	126.824562082291	122.962590340999	134.426222553427	120.961974045476	119.698752551675	119.723201418231	117.760975563699	123.276714472648	116.494764765545	118.821218092129	123.708482906587	114.675242584462	119.191487091405	121.424127556431	116.684580803635	108.587439674173	125.54828094925
Endocrine system	151.555190502407	145.821362102869	156.425686504756	155.010982542734	173.903177732874	163.017782195267	153.903966442378	154.652456998104	150.80362449641	165.598071040632	170.494077921208	147.985695395718	181.212888056599	171.006171055899	147.936002159332	171.544326575536	136.536328147623	146.020210188804
Energy metabolism	1227.79643114504	1235.53598005826	1123.99583411316	1259.92667645246	1189.18439811685	1152.72799843492	1172.09931373567	1111.44479005352	1158.60401676862	1150.95697330437	1196.70032917438	1217.20603937733	1158.09673100801	1184.79899211227	1178.87892350509	1163.42138933252	1034.2915852662	1217.26065441412
Environmental adaptation	37.6606146973091	37.0645108841241	29.1295020239019	32.0843133397313	30.9685721992645	27.8427941197447	38.9749681306525	27.7248301495731	51.7020404575751	30.8345779180498	36.6900881831938	44.5488154403042	30.6113536012296	34.6529227742758	47.4139219708206	37.3195986038866	29.9034319603779	33.7925180474678
Excretory system	20.6132476248577	17.1283336120344	21.6801846629514	22.5032056670741	19.8704051986765	17.4721060190619	23.2575660534694	22.2865223128386	14.4756493612024	11.8972942194093	21.0219256693263	21.6374657554357	10.258137065821	16.1303857742974	17.4324304629689	11.2952618926419	24.608211937562	18.3711762972796
Folding, sorting and degradation;	484.128011894883	495.690699148098	487.668353917682	486.681194371032	473.391656116916	488.084557986232	458.806170171515	465.305852950833	466.137128280274	467.406848075781	462.065760560692	462.24366604963	463.36671582878	472.126265290543	461.516070305358	460.330711083041	454.19679974865	468.480066415185
Global and overview maps	1344.38903614305	1357.20505099984	1309.1196008114	1326.64130320595	1369.66817384765	1386.81360457965	1385.4032563769	1287.90204467022	1435.33707906187	1451.6850571805	1421.09635909398	1359.80757097964	1475.58036772025	1384.7450364769	1446.32348086995	1478.20317782517	1210.02721362558	1388.63606907427
Glycan biosynthesis and metabolism	709.498133731514	548.097394269798	655.677367759086	500.037795570373	706.30802364998	753.083961637261	618.073101712741	739.623850037613	439.550233928794	760.47087360696	746.942420831543	527.261034499553	848.302697933946	750.861007700823	460.898271030973	714.172960272466	634.609778163725	641.549914186408
Immune diseases	25.3790506187218	29.4819991292635	27.7709804759611	23.5888586478152	26.4853390352017	30.0105685774383	26.4430985187011	26.6257987132186	27.9824379427795	35.7368161686117	27.9386177364498	22.8786296604044	36.9821199438609	31.0715985228466	25.2976333778022	34.7350107524417	24.6942084967374	31.0813096355385
Immune system	65.834603388411	65.3705390998381	59.1305944881161	66.2428744046931	58.6006843053759	57.7871147255413	69.3516163471633	54.6441456132281	73.577196805417	62.4038896490786	62.4271664743517	62.3920099962912	65.9946229410793	62.6891897619388	65.5902820124435	66.1618921600768	52.3768548758951	60.4652667711523
Infectious diseases: Bacterial	149.13173198621	156.45129576684	131.163870055173	146.009565726897	134.611236217029	120.186494405749	137.014256324436	132.028848139913	166.243032579174	123.611600813273	129.154424153196	177.277443479558	126.161558652851	129.985044192442	157.159807782153	132.527544752518	135.52686837934	145.084527298251
Infectious diseases: Parasitic	0.495869151950528	0.737030478047093	1.42478951684939	0.555351430462181	0.530898954716086	0.433873956014106	0.425543125715517	2.17150362640775	0.476623498029494	0.239275346129886	0.656088829967151	0.967570517957722	0.270977158591268	0.261535162238778	0.198656182054642	0.15965830829294	3.66985291748839	0.48719971389411
Infectious diseases: Viral	2.45822728543039	2.37169086149974	3.74489726186679	2.27379357360944	3.70444718408251	3.35179953254587	2.75349558817472	3.55158858126572	3.17483261026454	3.29041135928321	3.35263163681163	3.76604614027189	4.62140885656022	3.12989126005315	2.34379566534858	3.17972816097747	3.2327288824321	2.62486363702516
Lipid metabolism	656.012385012797	628.484468529602	638.707153077726	622.039551489368	609.275104033784	624.270482369702	650.980179943137	626.551326162236	660.109583838347	607.882062666136	637.658452156337	650.718473452017	606.988110706704	646.400092788248	639.606079007906	611.098630697487	619.4245549463	639.945654873029
Membrane transport	195.346224266651	203.625897395482	237.997914020797	206.996512670771	198.90708044182	194.048463229839	217.80869688062	242.968884496849	242.778685635514	191.783955832035	206.901378389356	226.824312945205	169.443187192319	199.955143969775	239.142917878835	193.454045395022	287.808210537629	195.486408555847
Metabolism of cofactors and vitamins	1505.96966218223	1524.96953476716	1532.32217254309	1381.67530105755	1544.46891548061	1601.09117114177	1449.36872262069	1596.57182022495	1323.95694899048	1565.81146644446	1522.69275256274	1393.99414718254	1621.16597346098	1539.32267134064	1351.95028328857	1532.94219686995	1530.78673311715	1528.71449869539
Metabolism of other amino acids	991.212640941853	1032.95038298907	1152.33152517119	905.260824892494	1279.75794218252	1271.267994756	954.650195961354	1226.97904440564	875.842989524332	1328.78173976791	1272.91447360729	963.509425202992	1508.96626486198	1227.73200474546	915.937334962914	1313.27931054727	1127.00411528094	1113.1292599735
Metabolism of terpenoids and polyketides	418.193088057868	425.163042209439	433.570262736957	396.091790389168	497.896957911579	464.9056095732	429.488198840546	484.347622554613	397.875958390796	597.771977541307	493.460425691907	403.726732074468	636.169902096735	490.354384323353	414.075663215211	568.656059266268	432.94113352299	451.01053868144
Nervous system	69.056738332326	68.6100503127078	66.1985779030876	69.3409893106201	69.4546900704018	70.5759085093802	68.941898251418	65.0309869783129	65.2231812189901	68.7382143249211	70.4622682163401	73.3807399168752	77.5776270173501	71.7569681428279	69.0747430885925	75.3213006823626	60.9531792977088	78.4792584972638
Neurodegenerative diseases	25.2278943694047	25.8101678657613	20.0931294047859	25.1113337249582	19.4909315703085	16.6104228221437	19.3844190180821	20.453346656091	25.4081742582035	14.5984913325564	17.4826501463691	22.9514110234842	13.8416578768216	17.4084014236638	20.7938415846037	14.8970122366756	23.1037717752547	19.6304232650645
Nucleotide metabolism	373.411633433383	393.57729070505	371.545830866929	384.006665371845	379.552328492856	383.480528571269	370.177148270824	354.026001397027	377.390803700539	371.791917882081	374.430251920791	373.492073371989	373.934731343438	380.783211100161	376.987696543244	375.10109397159	333.058142352237	392.213822100094
Replication and repair	869.20984530591	915.905178238626	907.360988945346	860.684248760748	919.488730628146	943.456223032202	862.301477637333	872.633151110866	898.154262627558	920.658636313478	912.32539303251	866.199483140558	942.26433922885	938.774889696461	891.483957572379	919.083113373722	814.603574959988	912.569478919166
Sensory system	0.910249600279718	0.00403265785074627	0.950814060995058	0.152066380111111	0.994177088399611	0.00972633922222222	0	0.169899247124445	0.277917153147927	0.015118369	0	9.99430706246733	7.0424798313791	0.0178716443333333	0.003343812	0.0141384807777778	0.0820708090873964	0.0200194743067994
Signal transduction	139.63716722921	137.570644554524	132.324815548724	138.724107488965	123.674547880693	120.58035593814	124.919351902127	133.954037651445	133.379150032451	108.262598097332	118.874685009845	142.862970200288	108.214499265156	121.49646339111	127.66550518614	110.318429928326	140.778032688837	124.919405450623
Signaling molecules and interaction	0.16024124576417	0.0654381534383266	0.0488833605935223	0.0417407674898785	0.159204115060729	0.104834613967611	0.170825693688259	0.146314003475776	0.102092980931174	0.0673590011307692	0.153265390703846	0.0708664263425101	0.0111554003765182	0.075699394802834	0.0636706223915655	0.0700352268887989	0.196690803068016	0.0363051398097166
Substance dependence	0.286689329259516	0.0312913808952381	0.458968274170489	0.0311505981309524	0.756001520785963	0.0282672983344246	0.0603873589378028	0.127343333144528	0.0688340715317461	0.00893285982142857	0.0145005863683375	2.36683735096479	0.927213922697368	0.0822076855339182	0.0237062894273601	0.00382810851111111	0.0422658232537176	0.0205201312960318
Transcription	116.301757169774	128.238027162036	107.97999745739	127.186603563607	106.083619679224	105.741781792333	110.394243521947	93.0257719990536	119.751503011873	101.103974144157	101.089614667922	117.39782579832	94.959942066428	104.349637414606	117.511350355927	101.629905841654	86.2595101828843	116.246525486101
Translation	1252.21213194756	1332.72339052891	1125.5423837472	1362.45472376031	1139.62746093546	1141.7238900096	1201.577398719	993.646144643506	1252.39755695604	1121.07739067362	1079.43383296605	1217.99273845825	1072.9685386393	1140.81603894767	1225.97408024022	1116.04883900663	889.680323859663	1206.86130094552
Transport and catabolism	41.0874172148159	32.7298526769524	37.7812866744737	31.5489560014991	41.0279456622013	45.2005258269029	37.5523895780765	40.6063014525599	32.1890616964691	43.8041976730222	39.214683952625	36.6802180799458	52.0357958007371	39.1294440506188	30.9914758841393	42.7671861275969	38.6407207187133	35.1097391354831
Xenobiotics biodegradation and metabolism	529.366834496999	536.12999732709	553.346040828109	613.103766620696	455.174574554022	491.820268622609	521.821645989333	522.368750592665	555.371756393965	416.064499570833	430.209404384918	535.339634807475	350.832239168133	450.32154202304	502.749781854883	399.543151231359	566.003791419628	511.631946018938
"

data<-read.table(text=input, header=T, row.name = 1, sep="\t")
class(data)
data2<-t(data[,order(colnames(data))])
head(data2)
class(data2)
data3<-prop.table(data2, margin=1)

rowSums(data3)
head(data3)

data4<-data3*100

data5<-melt(data4, id.var="SampleID")
colnames(data5)<-c('SampleID', 'Function', 'Proportion')
pallet<-c(brewer.pal(12,"Paired"),brewer.pal(8,"Set2")[-c(7,8)],brewer.pal(8,"Dark2"),brewer.pal(12,"Set3"),brewer.pal(8,"Accent"),brewer.pal(11,"Spectral"))

p<-ggplot(data5, aes(x = SampleID, y = Proportion, fill = Function)) + 
	geom_bar(stat = "identity",width = 0.7)+
  	guides(fill=guide_legend(title = NULL))+
  	scale_fill_manual(values = pallet)+
 	xlab("")+ylab("Sequence Number Percent(%)")+theme_bw()+
  	theme(text = element_text(size = 10),
        panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
        axis.line = element_line(),panel.border =  element_blank(),
        axis.text.x = element_text(angle = 45,size = 10,hjust = 1))+
  	scale_y_continuous(limits=c(0,101), expand = c(0, 0)
)


ggsave(plot = p,filename = "all.merged.abundance.KeepID.Pathway.Level2.png",width = 20,height = 8,dpi = 300)
ggsave(plot = p,filename = "all.merged.abundance.KeepID.Pathway.Level2.pdf",width = 20,height = 8,dpi = 300)