library(reshape2)
library(ggplot2)
library(RColorBrewer)


setwd("~/Desktop")

input <-"orthology	P1A	P1B	P2A	P2B	P3A	P3B	P4A	P4B	P5A	P5B
Aging	86.764511501577	72.1073003424163	95.685257485887	86.0917755994052	75.9891068295071	80.9093579371831	91.0184622558959	89.7514356503725	96.1863676129944	79.7653887462677
Amino acid metabolism	1883.28355970204	1582.0119932312	2223.48847412852	1531.13780385446	1919.61719372066	1853.06309620644	1958.47650963603	2069.02766984634	2146.70021827607	1812.238403892
Biosynthesis of other secondary metabolites	1258.19380245107	710.742120707806	1734.23309782251	727.964683189551	1235.58626269504	1185.60698693752	1452.2577353498	1579.06726094172	1505.06549552489	1337.69440287099
Cancers: Overview	96.548800332409	110.935226897273	77.0470695795792	118.88508456858	110.515152416709	102.688391836575	86.8924072786553	81.3812056498979	79.2578656084547	99.3031679269565
Cancers: Specific types	12.0192763564196	27.2758831047698	12.0690272078085	22.533597001977	9.79897800462083	13.8593845434766	15.438323739406	15.095208711863	8.60955104275664	9.95314678272991
Carbohydrate metabolism	2036.92708475121	2071.14774910672	2258.25513792325	1770.01592077207	2112.17511043055	2060.79995413078	2074.48520993412	2173.96147475472	2245.11303176431	2083.45021882513
Cardiovascular diseases	32.9419607943503	25.9306757867812	39.4831704099505	23.4593315374859	30.8957494508602	32.4846183489427	35.3447012900085	38.4928891287954	32.8268342082094	31.1305674960357
Cell growth and death	339.684279297774	187.644420400113	363.880646776002	233.590919862994	344.30614187329	323.090871036705	320.907932240589	335.581453872034	331.601475360671	346.806410803023
Cell motility	206.350447632626	399.349832071006	86.5257434148136	374.569515669603	71.7484178077141	195.351744330776	243.084618238897	155.297564213689	245.015186352073	72.1731778777088
Cellular community - eukaryotes	0	0.0335768569960435	0.00748464127816025	0.0304860712680497	0	0	0	0.0044879573980656	0.0247783862966881	0.0154520496753627
Cellular community - prokaryotes	237.427959937005	435.503496494957	192.273331864355	413.535121890208	216.504330368751	247.668766282251	252.714968207497	232.319050757715	204.768169366234	190.766208477537
Chemical structure transformation maps	0.793505973075191	7.45460981986064	0.486704429128378	0	0	0.484180662457416	0	0.185251355528536	0.483333916954469	0.812925679589935
Circulatory system	0.0549175856410445	0.0789227474798705	0.00224257024776247	0.130267619643666	0	0.00280137064898711	0.0447146406626331	0.00284868291296256	0.0044941012408491	0.0619114125096547
Development	0.499330718614402	0	0.142171621540664	0.00749858147984401	0.622997152993084	0.446858829575392	0.288052946850852	0.340077748847003	0.429664659532186	0.497027413611235
Digestive system	43.0926801448047	28.6325595231875	22.636123456914	28.1878041507421	46.5134599908809	37.30392395397	30.9026100141213	32.4669749376098	30.0853381647588	53.3869417086365
Drug resistance: Antimicrobial	356.648151616907	382.204120324016	361.215074964459	414.46779457986	374.628595364267	358.847757321915	364.570017518318	364.993918087942	396.940927818858	356.426714570393
Drug resistance: Antineoplastic	134.652736267606	109.065644910651	160.282375872152	145.548599227918	150.522984294653	135.843144083222	153.177357945421	149.557187478905	176.534734200143	143.274742283414
Endocrine and metabolic diseases	89.865888698878	64.7896901546354	101.331720051887	76.1341803330089	88.1628033786916	88.882648689839	92.2672702907305	92.802385673569	88.4310088588795	88.2109827488191
Endocrine system	163.53403208053	96.1994485810367	166.753190413213	116.219669279154	172.744443478321	165.635756417943	148.679398632918	157.486974208249	144.583255173318	169.777731533251
Energy metabolism	801.408424612369	734.001361601248	998.116068773891	691.56262693851	840.380440722624	791.733442244242	876.066675357133	898.846079972545	954.788132510214	788.319183049025
Environmental adaptation	35.0762366919276	24.0578912351987	28.1832893695303	23.0299170365687	36.3857251749148	34.6153702449611	28.712188035414	30.1971389614771	33.9460027672643	38.8359382875717
Excretory system	40.5666112687246	39.791575291955	19.7113394370759	28.1619393235835	54.4795363548614	46.1638995121909	24.2469939704478	26.2450377179728	11.1602302557461	49.3781339663344
Folding, sorting and degradation;	472.471952642398	394.717917611974	482.03138338631	490.782680760292	465.501826436137	437.481968579297	443.654307865919	445.415024944716	489.704697231237	441.885121649951
Global and overview maps	1120.5237023609	925.705550262611	1325.55832722506	918.971323590018	1126.51068564215	1070.76601085004	1161.22231140832	1217.01163638315	1277.13418116149	1070.86596566941
Glycan biosynthesis and metabolism	1663.9664575477	517.895309356714	1144.80544475996	614.330210214599	1768.01765535825	1619.33157237271	1125.92633779776	1300.91499678958	1068.52922556118	2179.4704178689
Immune diseases	28.5846555517509	16.7866383043523	29.9038962914621	21.1620145609041	24.4356034565489	28.4019862610914	30.6923011373078	28.6534378845775	35.6267508526313	24.4608939430183
Immune system	55.5498397893815	35.8788716665133	59.3842572131095	28.5890002961419	47.4409359587513	53.4898154519025	58.008715615075	60.902012854766	52.1735911173562	54.036828305734
Infectious diseases: Bacterial	85.1647606867983	119.167364268832	98.0924805505843	140.845894173252	78.5321458340854	82.9335586078171	106.899819752765	97.9027956857701	98.8574728310162	78.5467894947246
Infectious diseases: Parasitic	2.36166215222525	12.2213824120724	1.42002012738004	9.95955776087932	1.12822808749465	4.21157605660724	3.22883937207779	2.9916900014123	0.684367557917707	2.59701990642782
Infectious diseases: Viral	3.41033023090438	2.38702928932145	3.60936293372827	2.98039506624045	3.89935433841441	3.15533749682487	3.0735449116249	3.20937898242627	4.41915468485483	3.65111133922326
Lipid metabolism	832.557300438704	723.437329307204	739.962174621081	691.35523447988	778.818531252197	782.355892970064	743.46491974653	764.476580107906	715.276300964371	833.793995293569
Membrane transport	205.141361265254	430.176222610438	219.494622967709	404.624693596283	192.784896478452	212.250983260074	250.04211404621	232.384015849938	230.315826615048	166.907043243395
Metabolism of cofactors and vitamins	1804.07568910832	1591.61707738811	1694.63444784235	1739.39009578097	1915.80755520632	1865.54968474123	1673.13060745823	1682.77920882109	1748.72297813308	1888.37868169567
Metabolism of other amino acids	1219.51101366517	1158.49710281161	1396.92617632402	1214.02581389495	1251.32097746578	1235.79505587889	1332.59891756912	1330.29440286929	1238.66781820011	1221.62780887139
Metabolism of terpenoids and polyketides	412.579084180057	479.931047370163	522.5581307514	381.425306625244	403.312746510539	412.905806410139	484.802454341273	503.081466687891	443.99099480024	418.480053967255
Nervous system	56.3905076857113	31.0583024318074	68.3283524661078	31.0617734703013	72.4155374877635	65.3340943990744	53.6070470988794	57.8515917838385	54.3778692425781	68.3420679153297
Neurodegenerative diseases	17.2654760817852	30.9109798244197	12.324771579312	32.8349150024351	11.4523022659369	17.0926319056226	17.6766220998087	16.8125280781907	17.6737205636457	13.8020436303985
Nucleotide metabolism	278.668793327195	234.147043938457	335.788778863043	279.930036996822	285.038095324965	266.811030443467	305.151840366754	302.055517810897	328.593436962126	269.671870725648
Replication and repair	829.943737453849	646.816490517464	877.573620232239	834.128778301462	852.719540375051	815.728990264604	839.536487342342	805.325922111716	913.155103266902	791.454279988972
Sensory system	0	0.0393262630512991	0.0107622388779169	0	0	0	0	0.0101203389783173	0.0215674809490667	0.0842663589806264
Signal transduction	138.074116572049	176.892182809968	109.012088741382	177.8963032834	124.215723996408	134.728765295191	129.890077983854	123.565028198829	134.271452077449	125.099644203087
Signaling molecules and interaction	0.332424224845026	0.0487663044941202	0.187678418758021	0.0230906269195845	0.855159396996093	0.440134613729502	0.0742715055583308	0.0753675169161374	0.227202156810011	0.673353527360733
Substance dependence	0.0058455423237198	0.0121544082232724	0.0165550428922763	0.0220073098205637	0	0	0.0408063727769797	0.00812447165108585	0.0142221015663336	0.043720221381156
Transcription	47.1526851513615	29.659534895997	72.547722993087	44.930545259361	42.7442020163335	39.0091158625812	59.0390208229707	59.2151941496065	62.5950725896528	42.2498973509904
Translation	562.976298251416	314.641969426826	849.126068813616	412.090437528395	523.345597445221	463.53819009	684.206661291199	684.026800470416	738.696701285809	514.423204037114
Transport and catabolism	90.1855161162393	34.6263591765513	65.641038691581	40.4182258691915	95.3794545522407	97.3092226856486	64.1629077163133	71.9570977344383	69.0960336256298	107.754140001636
Xenobiotics biodegradation and metabolism	354.975438311176	905.784035368174	343.665230540271	744.768380500356	340.207891883328	397.796877388689	432.626375771732	406.283462346287	346.512203274721	289.139144865711
"

data<-read.table(text=input, header=T, row.name = 1, sep="\t")
class(data)
data2<-t(data[,order(colnames(data))])
head(data2)
class(data2)
data3<-prop.table(data2, margin=1)

rowSums(data3)
head(data3)

data4<-data3*100

data5<-melt(data4, id.var="SampleID")
colnames(data5)<-c('SampleID', 'Function', 'Proportion')
pallet<-c(brewer.pal(12,"Paired"),brewer.pal(8,"Set2")[-c(7,8)],brewer.pal(8,"Dark2"),brewer.pal(12,"Set3"),brewer.pal(8,"Accent"),brewer.pal(11,"Spectral"))

p<-ggplot(data5, aes(x = SampleID, y = Proportion, fill = Function)) + 
	geom_bar(stat = "identity",width = 0.7)+
  	guides(fill=guide_legend(title = NULL))+
  	scale_fill_manual(values = pallet)+
 	xlab("")+ylab("Sequence Number Percent(%)")+theme_bw()+
  	theme(text = element_text(size = 10),
        panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
        axis.line = element_line(),panel.border =  element_blank(),
        axis.text.x = element_text(angle = 45,size = 10,hjust = 1))+
  	scale_y_continuous(limits=c(0,101), expand = c(0, 0)
)


ggsave(plot = p,filename = "all.merged.abundance.KeepID.Pathway.Level2.png",width = 20,height = 8,dpi = 300)
ggsave(plot = p,filename = "all.merged.abundance.KeepID.Pathway.Level2.pdf",width = 20,height = 8,dpi = 300)